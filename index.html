<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>2D Minecraft med Gravitation</title>
<style>
  body { margin: 0; overflow: hidden; background: #87CEEB; }
  canvas { display: block; background: #87CEEB; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 800;
canvas.height = 600;

const TILE_SIZE = 40;
const WORLD_WIDTH = canvas.width / TILE_SIZE;
const WORLD_HEIGHT = canvas.height / TILE_SIZE;

// Blocktyper: 0 = tomt, 1 = jord, 2 = gräs
const BLOCKS = {
  0: null,
  1: "#8B4513", // jord
  2: "#228B22"  // gräs
};

// Skapa världen
const world = [];
for(let x=0; x<WORLD_WIDTH; x++){
  world[x] = [];
  for(let y=0; y<WORLD_HEIGHT; y++){
    if(y === WORLD_HEIGHT - 2){
      world[x][y] = 2; // gräs på toppen
    } else if(y > WORLD_HEIGHT - 2){
      world[x][y] = 1; // jord under gräs
    } else {
      world[x][y] = 0; // tomt
    }
  }
}

// Spelarens position och fysik
let player = {
  x: 5,
  y: 5,
  width: 1,
  height: 1,
  velY: 0,
  onGround: false
};

// Spelinställningar
const gravity = 0.5;
const jumpStrength = -10;

// Tangenter
const keys = {};

// Händelser
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// Hantera musklick för block
canvas.addEventListener("mousedown", (e) => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  const tx = Math.floor(mx / TILE_SIZE);
  const ty = Math.floor(my / TILE_SIZE);

  if(e.button === 0) world[tx][ty] = 1; // vänsterklick = jord
  if(e.button === 2) world[tx][ty] = 0; // högerklick = ta bort
});
canvas.addEventListener("contextmenu", e => e.preventDefault());

// Kolla kollision
function isSolid(x, y){
  if(x < 0 || y < 0 || x >= WORLD_WIDTH || y >= WORLD_HEIGHT) return true;
  return world[x][y] !== 0;
}

// Uppdatera spelaren
function updatePlayer(){
  // Horisontell rörelse
  if(keys["ArrowLeft"]) player.x -= 0.2;
  if(keys["ArrowRight"]) player.x += 0.2;

  // Gravitation
  player.velY += gravity;
  player.y += player.velY * 0.1;

  // Kolla kollisioner
  let left = Math.floor(player.x);
  let right = Math.floor(player.x + player.width - 0.001);
  let top = Math.floor(player.y);
  let bottom = Math.floor(player.y + player.height - 0.001);

  player.onGround = false;
  // Bottenkoll
  for(let x=left; x<=right; x++){
    if(isSolid(x, bottom)){
      player.y = bottom - player.height + 0.001;
      player.velY = 0;
      player.onGround = true;
    }
  }

  // Hoppa
  if(keys[" "] && player.onGround){
    player.velY = jumpStrength;
    player.onGround = false;
  }
}

// Rita världen
function drawWorld(){
  for(let x=0; x<WORLD_WIDTH; x++){
    for(let y=0; y<WORLD_HEIGHT; y++){
      const color = BLOCKS[world[x][y]];
      if(color){
        ctx.fillStyle = color;
        ctx.fillRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE);
      }
    }
  }
}

// Rita spelaren
function drawPlayer(){
  ctx.fillStyle = "#00FF00";
  ctx.fillRect(player.x*TILE_SIZE, player.y*TILE_SIZE, player.width*TILE_SIZE, player.height*TILE_SIZE);
}

// Spelloop
function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  updatePlayer();
  drawWorld();
  drawPlayer();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
